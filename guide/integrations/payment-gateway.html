<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Payment Gateway Integration | Vue Storefront</title>
    <meta name="description" content="Headless PWA for eCommerce">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.ca5bf9f5.css" as="style"><link rel="preload" href="/assets/js/app.d8ba6bec.js" as="script"><link rel="preload" href="/assets/js/53.2decf3d6.js" as="script"><link rel="prefetch" href="/assets/js/10.aad38706.js"><link rel="prefetch" href="/assets/js/11.dbf0cd2d.js"><link rel="prefetch" href="/assets/js/12.8ab12175.js"><link rel="prefetch" href="/assets/js/13.7cddb3f7.js"><link rel="prefetch" href="/assets/js/14.1eec77ed.js"><link rel="prefetch" href="/assets/js/15.79b481f7.js"><link rel="prefetch" href="/assets/js/16.d5958d47.js"><link rel="prefetch" href="/assets/js/17.dad6938c.js"><link rel="prefetch" href="/assets/js/18.16b574f2.js"><link rel="prefetch" href="/assets/js/19.98bf533f.js"><link rel="prefetch" href="/assets/js/2.e420855b.js"><link rel="prefetch" href="/assets/js/20.3befc43a.js"><link rel="prefetch" href="/assets/js/21.5f76b73a.js"><link rel="prefetch" href="/assets/js/22.6ba6e9de.js"><link rel="prefetch" href="/assets/js/23.36cd1220.js"><link rel="prefetch" href="/assets/js/24.bb44e3f8.js"><link rel="prefetch" href="/assets/js/25.ed5e1c93.js"><link rel="prefetch" href="/assets/js/26.c6ce7dd6.js"><link rel="prefetch" href="/assets/js/27.b96d4e19.js"><link rel="prefetch" href="/assets/js/28.1069fe0a.js"><link rel="prefetch" href="/assets/js/29.8c6ca725.js"><link rel="prefetch" href="/assets/js/3.2995eee1.js"><link rel="prefetch" href="/assets/js/30.66e5e0e6.js"><link rel="prefetch" href="/assets/js/31.a5ed2179.js"><link rel="prefetch" href="/assets/js/32.80eacb41.js"><link rel="prefetch" href="/assets/js/33.096aa449.js"><link rel="prefetch" href="/assets/js/34.deb2389a.js"><link rel="prefetch" href="/assets/js/35.5224db0c.js"><link rel="prefetch" href="/assets/js/36.6777a517.js"><link rel="prefetch" href="/assets/js/37.cceecf56.js"><link rel="prefetch" href="/assets/js/38.727d4ca1.js"><link rel="prefetch" href="/assets/js/39.06021a50.js"><link rel="prefetch" href="/assets/js/4.56d2cd4c.js"><link rel="prefetch" href="/assets/js/40.a6db0c7d.js"><link rel="prefetch" href="/assets/js/41.1e93c319.js"><link rel="prefetch" href="/assets/js/42.d7408646.js"><link rel="prefetch" href="/assets/js/43.714cb975.js"><link rel="prefetch" href="/assets/js/44.38aad24b.js"><link rel="prefetch" href="/assets/js/45.2aa6fae9.js"><link rel="prefetch" href="/assets/js/46.ae82a2b4.js"><link rel="prefetch" href="/assets/js/47.4320ee7b.js"><link rel="prefetch" href="/assets/js/48.1f5cc9bd.js"><link rel="prefetch" href="/assets/js/49.d9d92b0f.js"><link rel="prefetch" href="/assets/js/5.468e6e0c.js"><link rel="prefetch" href="/assets/js/50.590c72f3.js"><link rel="prefetch" href="/assets/js/51.84d23438.js"><link rel="prefetch" href="/assets/js/52.46d9a3ae.js"><link rel="prefetch" href="/assets/js/54.d6cbd4a4.js"><link rel="prefetch" href="/assets/js/55.3c6ece4b.js"><link rel="prefetch" href="/assets/js/56.74ddfd82.js"><link rel="prefetch" href="/assets/js/57.1401c4b7.js"><link rel="prefetch" href="/assets/js/58.c9baf31f.js"><link rel="prefetch" href="/assets/js/59.aa39857f.js"><link rel="prefetch" href="/assets/js/6.9e714a77.js"><link rel="prefetch" href="/assets/js/60.4a3fb3d3.js"><link rel="prefetch" href="/assets/js/61.78de2281.js"><link rel="prefetch" href="/assets/js/62.abade39a.js"><link rel="prefetch" href="/assets/js/63.3f0ec155.js"><link rel="prefetch" href="/assets/js/64.e9046dd4.js"><link rel="prefetch" href="/assets/js/65.439a44e2.js"><link rel="prefetch" href="/assets/js/66.b8c911b7.js"><link rel="prefetch" href="/assets/js/67.c8004826.js"><link rel="prefetch" href="/assets/js/68.692e58e3.js"><link rel="prefetch" href="/assets/js/69.49751176.js"><link rel="prefetch" href="/assets/js/7.f63a084c.js"><link rel="prefetch" href="/assets/js/70.405beee7.js"><link rel="prefetch" href="/assets/js/8.29152829.js"><link rel="prefetch" href="/assets/js/9.af22b943.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ca5bf9f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vue Storefront</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.youtube.com/channel/UCkm1F3Cglty3CE1QwKQUhhg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/the-vue-storefront-journal" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Medium
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/DivanteLtd/vue-storefront" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.youtube.com/channel/UCkm1F3Cglty3CE1QwKQUhhg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/the-vue-storefront-journal" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Medium
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/DivanteLtd/vue-storefront" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/guide/" class="sidebar-link">Introduction to Vue Storefront</a></li><li><a href="/guide/upgrade-notes/" class="sidebar-link">Upgrade notes</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Installation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/installation/linux-mac.html" class="sidebar-link">Installing on Linux/MacOS</a></li><li><a href="/guide/installation/windows.html" class="sidebar-link">Installing on Windows</a></li><li><a href="/guide/installation/magento.html" class="sidebar-link">Integration with Magento 2</a></li><li><a href="/guide/installation/production-setup.html" class="sidebar-link">Production setup</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Basics</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/basics/release-cycle.html" class="sidebar-link">Release Cycle</a></li><li><a href="/guide/basics/project-structure.html" class="sidebar-link">Project structure</a></li><li><a href="/guide/basics/configuration.html" class="sidebar-link">Configuration file explained</a></li><li><a href="/guide/basics/contributing.html" class="sidebar-link">How to Contribute</a></li><li><a href="/guide/basics/feature-list.html" class="sidebar-link">Feature list</a></li><li><a href="/guide/basics/recipes.html" class="sidebar-link">FAQ and Recipes</a></li><li><a href="/guide/basics/typescript.html" class="sidebar-link">TypeScript Action Plan</a></li><li><a href="/guide/basics/graphql.html" class="sidebar-link">GraphQL Action Plan</a></li><li><a href="/guide/basics/ssr-cache.html" class="sidebar-link">SSR Cache</a></li><li><a href="/guide/basics/amp.html" class="sidebar-link">Google Accelerated Mobile Pages</a></li><li><a href="/guide/basics/e2e.html" class="sidebar-link">E2E tests</a></li><li><a href="/guide/basics/url.html" class="sidebar-link">Custom URL structure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Core and themes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/core-themes/themes.html" class="sidebar-link">Themes in Vue Storefront</a></li><li><a href="/guide/core-themes/layouts.html" class="sidebar-link">Layouts and advanced output operations</a></li><li><a href="/guide/core-themes/core-components.html" class="sidebar-link">Working with core components</a></li><li><a href="/guide/core-themes/ui-store.html" class="sidebar-link">Working with UI Store (Interface state)</a></li><li><a href="/guide/core-themes/translations.html" class="sidebar-link">Internationalization (i18n) of Vue Storefront</a></li><li><a href="/guide/core-themes/service-workers.html" class="sidebar-link">Working with Service Workers</a></li><li><a href="/guide/core-themes/webpack.html" class="sidebar-link">Working with Webpack</a></li><li><a href="/guide/core-themes/plugins.html" class="sidebar-link">Working with plugins</a></li><li><a href="/guide/core-themes/stylesheets.html" class="sidebar-link">Working with stylesheets in the 'default' theme</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Components</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/components/home-page.html" class="sidebar-link">Core Home Page</a></li><li><a href="/guide/components/category-page.html" class="sidebar-link">Core Category Page</a></li><li><a href="/guide/components/product.html" class="sidebar-link">Core Product Page</a></li><li><a href="/guide/components/modal.html" class="sidebar-link">Modal component</a></li><li><a href="/guide/components/events-list.html" class="sidebar-link">Events List</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Data in Vue Storefront</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/data/data.html" class="sidebar-link">Working with data</a></li><li><a href="/guide/data/elasticsearch.html" class="sidebar-link">ElasticSearch data formats</a></li><li><a href="/guide/data/data-migrations.html" class="sidebar-link">Data Migrations for ElacticSearch</a></li><li><a href="/guide/data/elastic-queries.html" class="sidebar-link">ElasticSearch Queries</a></li><li><a href="/guide/data/database-tool.html" class="sidebar-link">Database tool</a></li><li><a href="/guide/data/entity-types.html" class="sidebar-link">Data Entity Types</a></li><li><a href="/guide/data/static-data.html" class="sidebar-link">Static Data support in Vue Storefront</a></li><li><a href="/guide/data/data-loader.html" class="sidebar-link">Async Data Loader</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Extensions</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/extensions/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/guide/extensions/extending-api.html" class="sidebar-link">Extending the API</a></li><li><a href="/guide/extensions/extending-server-side-routes.html" class="sidebar-link">Extending Express.js server side routes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Working with Vuex</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/vuex/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/guide/vuex/vuex-conventions.html" class="sidebar-link">Vuex conventions</a></li><li><a href="/guide/vuex/product-store.html" class="sidebar-link">Product Vuex Store</a></li><li><a href="/guide/vuex/category-store.html" class="sidebar-link">Category Vuex Store</a></li><li><a href="/guide/vuex/stock-store.html" class="sidebar-link">Stock Vuex Store</a></li><li><a href="/guide/vuex/attribute-store.html" class="sidebar-link">Attribute Vuex Store</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Modules</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/modules/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/guide/modules/cart.html" class="sidebar-link">Cart module</a></li><li><a href="/guide/modules/user.html" class="sidebar-link">User Module</a></li><li><a href="/guide/modules/checkout.html" class="sidebar-link">Checkout Module</a></li><li><a href="/guide/modules/order.html" class="sidebar-link">Order module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Integrations</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/guide/integrations/integrations.html" class="sidebar-link">Existing integrations</a></li><li><a href="/guide/integrations/reviews.html" class="sidebar-link">Product Reviews</a></li><li><a href="/guide/integrations/payment-gateway.html" class="active sidebar-link">Payment Gateway Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#community-resources" class="sidebar-link">Community resources</a></li><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#frontend-integration" class="sidebar-link">Frontend integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#cash-on-delivery-example" class="sidebar-link">Cash on delivery example</a></li><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#more-examples" class="sidebar-link">More examples</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#backend-integration" class="sidebar-link">Backend Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#the-order-workflow-server-side" class="sidebar-link">The order workflow - server side</a></li><li class="sidebar-sub-header"><a href="/guide/integrations/payment-gateway.html#status-change-for-the-order" class="sidebar-link">Status change for the order</a></li></ul></li></ul></li><li><a href="/guide/integrations/paypal-payments.html" class="sidebar-link">PayPal payments support</a></li><li><a href="/guide/integrations/direct-prices-sync.html" class="sidebar-link">Direct prices sync with Magento</a></li><li><a href="/guide/integrations/tier-prices-sync.html" class="sidebar-link">Tier prices sync with Magento</a></li><li><a href="/guide/integrations/totals-sync.html" class="sidebar-link">Totals and cart sync with Magento</a></li><li><a href="/guide/integrations/multistore.html" class="sidebar-link">Multistore Magento2 support</a></li><li><a href="/guide/integrations/product-reviews.html" class="sidebar-link">Product Reviews</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="payment-gateway-integration"><a href="#payment-gateway-integration" aria-hidden="true" class="header-anchor">#</a> Payment Gateway Integration</h1> <p>Vue Storefront is platform-agnostic app. That means it can be connected to virtually any eCommerce backend. By the same time, most of the existing eCommerce platforms integrates the Payment Gateways (PG) using some kind of frontend hooks:</p> <ul><li>some gateways are integrated by iframe component,</li> <li>others are injected by JavaScript snippet etc.</li></ul> <p>In this situation it's a rare case when You can modify Your payment gateway with PWA - without creating the integration code by yourself.</p> <h2 id="community-resources"><a href="#community-resources" aria-hidden="true" class="header-anchor">#</a> Community resources</h2> <p>Our community members created some really cool docs and reference implementation of payment modules You could and probably should base on:</p> <ul><li>Blog post: <a href="https://www.develodesign.co.uk/news/development-of-the-paypal-module-for-vue-storefront/" target="_blank" rel="noopener noreferrer">How to create VS 1.6 payment module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Paypal integration: <a href="https://github.com/develodesign/vsf-payment-paypal" target="_blank" rel="noopener noreferrer">Paypal integration by Develodesign<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Braintree integration: <a href="https://github.com/danrcoull/vsf-payment-braintree" target="_blank" rel="noopener noreferrer">Braintree integration by Daniel Coull<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="frontend-integration"><a href="#frontend-integration" aria-hidden="true" class="header-anchor">#</a> Frontend integration</h2> <p>First step is to create a <a href="/guide/modules/introduction.html">Vue Storefront Module</a> to integrate the payment provider in the frontend. Any of the payment handling logic, UI is handled solely via the Module. For the most basic version of how a Payment Module is the &quot;src/modules/payment-cash-on-delivery&quot;.</p> <ul><li>The Payment Module where applicable should catch the <code>checkout-payment-method-changed</code> event, if the payment method code is the desired one, then you have the option to dynamically inject any components into the order review section on the checkout, (for example credit card input fields, payment method information etc).</li> <li>You are required to catch the <code>checkout-before-placeOrder</code> event and do any processing required for the payment method before placing the order.</li> <li>You are required to emit the <code>checkout-do-placeOrder</code> event with an optional payload to complete the placeorder process.</li> <li>For your payment method to display, add it to the Payment Methods collection in storage. <code>app.\$store.state.payment.methods.push(paymentMethodConfig)</code></li> <li>Unregister any events when they are no longer required.</li> <li>For clarity in growing extensions, payment extensions should be named clearly <code>payment-{VENDOR}-{PAYMENT_METHOD}</code></li></ul> <h3 id="cash-on-delivery-example"><a href="#cash-on-delivery-example" aria-hidden="true" class="header-anchor">#</a> Cash on delivery example</h3> <p>Here is an example of &quot;Cash on delivery&quot; payment method main logic. It's placed in the <code>src/modules/payment-cash-on-deliver/hooks/afterRegistration.ts</code> which is usually good entry point for registering custom event hooks:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> InfoComponent <span class="token keyword">from</span> <span class="token string">'../components/Info.vue'</span>
<span class="token keyword">import</span> rootStore <span class="token keyword">from</span> <span class="token string">'@vue-storefront/core/store'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">afterRegistration</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Vue<span class="token punctuation">,</span> config<span class="token punctuation">,</span> store<span class="token punctuation">,</span> isServer <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Place the order. Payload is empty as we don't have any specific info to add for this payment method '{}'</span>
  <span class="token keyword">const</span> <span class="token function-variable function">placeOrder</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'checkout-do-placeOrder'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Update the methods</span>
    <span class="token keyword">let</span> paymentMethodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Cash on delivery'</span><span class="token punctuation">,</span>
      <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'cashondelivery'</span><span class="token punctuation">,</span>
      <span class="token string">'cost'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">'costInclTax'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string">'offline'</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    rootStore<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'payment/addMethod'</span><span class="token punctuation">,</span> paymentMethodConfig<span class="token punctuation">)</span>

    <span class="token comment">// Mount the info component when required.</span>
    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-payment-method-changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>paymentMethodCode<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentMethodCode <span class="token operator">===</span> <span class="token string">'cashondelivery'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Register the handler for what happens when they click the place order button.</span>
        Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> placeOrder<span class="token punctuation">)</span>

        <span class="token comment">// Dynamically inject a component into the order review section (optional)</span>
        <span class="token keyword">const</span> Component <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>InfoComponent<span class="token punctuation">)</span>
        <span class="token keyword">const</span> componentInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        componentInstance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#checkout-order-review-additional'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// unregister the extensions placeorder handler</span>
        Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> placeOrder<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="more-examples"><a href="#more-examples" aria-hidden="true" class="header-anchor">#</a> More examples</h3> <p>You can find much more sophisticated solutions for <a href="https://github.com/develodesign/vsf-payment-paypal" target="_blank" rel="noopener noreferrer">Paypal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> on our partner - <strong>Develodesign</strong> github and <a href="https://github.com/danrcoull/vsf-payment-braintree" target="_blank" rel="noopener noreferrer">Braintree<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>More info:</p> <ul><li><a href="https://www.develodesign.co.uk/news/development-of-the-paypal-module-for-vue-storefront/" target="_blank" rel="noopener noreferrer">How to create VS 1.6 Payment module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="backend-integration"><a href="#backend-integration" aria-hidden="true" class="header-anchor">#</a> Backend Integration</h2> <p>After successfully integrating the payments on the frontend you're sending the users and transactions to the payment integrator. Then we need to get back the payment token/identifier and update the order status as soon as the payment integrator will let us know that the transaction finished.</p> <p>To store the transaction info you'll get from the payment service you may emit an event:</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">placeOrderWithPayload</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'checkout-do-placeOrder'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
</code></pre></div><p>Where the payload equals to JSON object with additional order information.
This object will be transferred to the server along with the order object in the <code>order.payment_method_additional</code> property.</p> <h3 id="the-order-workflow-server-side"><a href="#the-order-workflow-server-side" aria-hidden="true" class="header-anchor">#</a> The order workflow - server side</h3> <p>To get it right, first we must understand how Vue Storefront processes orders.
Vue Storefront sends orders to the server asynchronously because of the offline orders support (order can be send immediately after placed, minutes after or even hours).</p> <p>The order is being send to <code>vue-storefront-api/api/order/create</code> endpoint. This API endpoint pushes the order to the queue from where it's being transferred to the eCommerce backend by cron-run process called <code>order_2_magento2.js</code> (o2m). You may find the source code of <code>o2m</code> in the <code>vue-storefront-api/worker</code> folder.</p> <p>As You see we don't have the backend's order number immediately after order has been placed. To pair the client side order id and server side meta data <code>order_2_magento.js</code> process stores special metadata entries in <code>Redis</code> cache:</p> <div class="language-js extra-class"><pre class="language-js"><code>api<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cartId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;paymentMethod&quot;</span><span class="token punctuation">:</span>
  <span class="token punctuation">{</span>
      <span class="token string">&quot;method&quot;</span><span class="token punctuation">:</span>orderData<span class="token punctuation">.</span>addressInformation<span class="token punctuation">.</span>payment_method_code<span class="token punctuation">,</span>
      <span class="token string">&quot;additional_data&quot;</span><span class="token punctuation">:</span>orderData<span class="token punctuation">.</span>addressInformation<span class="token punctuation">.</span>payment_method_additional
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> isThisAuthOrder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> job<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span>currentStep<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token constant">TOTAL_STEPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span> <span class="token operator">+</span> <span class="token string">'[OK] Order placed with ORDER ID'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  redisClient<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;order$$id$$&quot;</span> <span class="token operator">+</span> orderData<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
      platform_order_id<span class="token punctuation">:</span> result<span class="token punctuation">,</span>
      transmited<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      transmited_at<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      platform<span class="token punctuation">:</span> <span class="token string">'magento2'</span><span class="token punctuation">,</span>
      order<span class="token punctuation">:</span> orderData
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  redisClient<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;order$$totals$$&quot;</span> <span class="token operator">+</span> orderData<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> job<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span>currentStep<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token constant">TOTAL_STEPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> magentoOrderId<span class="token punctuation">:</span> result<span class="token punctuation">,</span> transferedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As You may see - You can get the order data using <strong>client side</strong> order id by accesing the <code>order$$id$${clientsideorderid}</code> in local Redis instance.</p> <p>You may check <code>vue-storefront-api/src/api/sync.js</code> the <code>check</code> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> config<span class="token punctuation">,</span> db <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> syncApi <span class="token operator">=</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * GET get stock item
   */</span>
  syncApi<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/order/:order_id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// workaround for https://github.com/NodeRedis/node_redis/issues/713</span>
      redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'order$$id$$'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">'order_id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
      err<span class="token punctuation">,</span>
      reply<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderMetaData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>orderMetaData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        orderMetaData<span class="token punctuation">.</span>order <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// for security reasons we're just clearing out the real order data as it's set by `order_2_magento2.js`</span>
      <span class="token punctuation">}</span>
      <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err <span class="token operator">?</span> err <span class="token punctuation">:</span> orderMetaData<span class="token punctuation">,</span> err <span class="token operator">?</span> <span class="token number">500</span> <span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> syncApi<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>As this method returns the order data by non-secured URL with just client side order id - there is <code>order</code> property being removed to return just the platform id of their order.</p> <h3 id="status-change-for-the-order"><a href="#status-change-for-the-order" aria-hidden="true" class="header-anchor">#</a> Status change for the order</h3> <p>The example shown above was a prep. step for updating the Magento (or other platform) order status based on the response from the payments integrator.</p> <p>First of all - You need to add the special endpoint under public URL which will be getting the notifications / statuses from the payments provider. Here is an example [how to add custom API endpoint to the <code>vue-storefront-api</code>](Extending vue-storefront-api.md).</p> <p>To add the API extension to <code>vue-storefront-api</code>:</p> <ol><li>Create the folder within <code>src/api/extensions</code> for example 'custom-payment-method`</li> <li>Then add the <code>index.js</code> file and put the API methods code inside. We're using Express.js. Here is a boilerplate/example for the extension code:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> apiStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../lib/util'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> config<span class="token punctuation">,</span> db <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> mcApi <span class="token operator">=</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * POST create an user
   */</span>
  mcApi<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/status'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> notificationData <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">const</span> order_id <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// we should extract the client's order id from the notification status</span>
    <span class="token comment">/// ... business logic related to the status verification</span>

    <span class="token comment">// getting the data from Redis - the original order</span>
    <span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> Magento2Client <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'magento2-rest-client'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Magento2Client<span class="token punctuation">;</span>

    <span class="token keyword">let</span> redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// workaround for https://github.com/NodeRedis/node_redis/issues/713</span>
      redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'order$$id$$'</span> <span class="token operator">+</span> order_id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> reply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderMetaData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>orderMetaData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// now we can use the api client to update the order status in Magento</span>
        <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">Magento2Client</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>magento2<span class="token punctuation">.</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token string">'invoice'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>restClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

          module<span class="token punctuation">.</span><span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> restClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/invoice/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// the real Magento2 endpoint should be here - this is just an example</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> module<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span>invoice
          <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just dump it to the browser, result = JSON object</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> mcApi<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Add the extension to <code>config/local.json</code>:</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>	<span class="token property">&quot;registeredExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;custom-payment-method&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><ol start="4"><li>Restart the <code>vue-storefront-api</code></li> <li>Your new API method is available on <code>localhost:8080/api/ext/&lt;extension_name&gt;/&lt;extension_method&gt;</code> for example: <code>localhost:8080/api/ext/custom-payment-method/status</code></li></ol> <p>In this extension above You may want to get the order data by the client side order id (passed to the payment service and probably returned with the notification). Then <strong>You may use the Magento2 API to update the payment status</strong> - probably by executing the <code>invoice</code> method.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/DivanteLtd/vue-storefront/edit/master/docs/guide/integrations/payment-gateway.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/guide/integrations/reviews.html" class="prev">
          Product Reviews
        </a></span> <span class="next"><a href="/guide/integrations/paypal-payments.html">
          PayPal payments support
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/53.2decf3d6.js" defer></script><script src="/assets/js/app.d8ba6bec.js" defer></script>
  </body>
</html>
